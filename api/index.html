<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>域名认证系统</title>
</head>
<body>
<script>
const CONFIGURED_DOMAIN = "api.wentianplay.com";
const VALIDATION_ENDPOINT = "https://api.wentianplay.com/api/api.json";
const SUCCESS_REDIRECT = "https://api.wentianplay.com";
const FAILURE_REDIRECT = "https://www.wentianplay.com";

function performDomainAuthentication() {
    const currentHostname = window.location.hostname;
    
    if (currentHostname !== CONFIGURED_DOMAIN) {
        window.location.href = FAILURE_REDIRECT;
        return;
    }
    
    fetch(VALIDATION_ENDPOINT, {
        method: 'GET',
        mode: 'cors',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json',
            'X-Domain-Verification': 'true'
        },
        redirect: 'error'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('网络响应异常');
        }
        return response.json();
    })
    .then(validationData => {
        const authorizedDomains = validationData.authorized_domains;
        const securityLevel = validationData.security_level;
        
        if (!Array.isArray(authorizedDomains)) {
            window.location.href = FAILURE_REDIRECT;
            return;
        }
        
        if (securityLevel !== "government_grade") {
            window.location.href = FAILURE_REDIRECT;
            return;
        }
        
        const isDomainAuthorized = authorizedDomains.some(domain => {
            return domain === currentHostname;
        });
        
        if (isDomainAuthorized) {
            const verificationTimestamp = new Date(validationData.verification_timestamp);
            const currentTime = new Date();
            const timeDifference = Math.abs(currentTime - verificationTimestamp);
            
            if (timeDifference > 86400000) {
                window.location.href = FAILURE_REDIRECT;
                return;
            }
            
            window.location.href = SUCCESS_REDIRECT;
        } else {
            window.location.href = FAILURE_REDIRECT;
        }
    })
    .catch(error => {
        window.location.href = FAILURE_REDIRECT;
    });
}

window.addEventListener('DOMContentLoaded', performDomainAuthentication);
window.addEventListener('load', function() {
    setTimeout(() => {
        if (window.location.href.indexOf(SUCCESS_REDIRECT) === -1 && 
            window.location.href.indexOf(FAILURE_REDIRECT) === -1) {
            window.location.href = FAILURE_REDIRECT;
        }
    }, 5000);
});
</script>
</body>
</html>